---
title: "Calendar-based graphics for visualising people's daily schedules"
author:
  - familyname: Wang
    othernames: Earo
    address: Department of Econometrics and Business Statistics, \newline Monash University, VIC 3800 \newline Australia.
    email : earo.wang@monash.edu
    correspondingauthor: true
  - familyname: Cook
    othernames: Di
    address: Department of Econometrics and Business Statistics, \newline Monash University, VIC 3800 \newline Australia.
    email : dicook@monash.edu
  - familyname: Hyndman
    othernames: Rob
    address: Department of Econometrics and Business Statistics, \newline Monash University, VIC 3800 \newline Australia.
    email : rob.hyndman@monash.edu
fontsize: 11pt
papersize: a4
fontfamily: mathpazo
blind: false
cover: true
wpnumber: no/yr
jelcodes: C10,C14,C22
bibliography: references.bib
biblio-style: authoryear-comp
abstract: "A brief summary of our ideas"
keywords: "blah, blah"
subparagraph: true
toc: false
output: 
  bookdown::pdf_document2:
    template: monashwp.tex
    fig_caption: yes
    fig_height: 5
    fig_width: 8
    number_sections: yes
    citation_package: biblatex
---

```{r initial, echo = FALSE, cache = FALSE, results = 'hide'}
library(knitr)
opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE,
  fig.path = 'figure/', cache.path = 'cache/', fig.align = 'center', 
  fig.show = 'hold', cache = TRUE, external = TRUE, dev = "svglite")
```

# Introduction

Calendar-based visualisation proves useful in unfolding human-related activities in temporal context. For example, @van_wijk_cluster_1999 developed a calendar view of heatmap to represent the number of employees in the office over a year, where colours indicate different clusters derived from the days. It effectively contrasts weekdays and weekends, highlights public holiday, and presents other known seasons like school vacations, all of which have influence over the turn-outs in the office. However, their technique is too constrained to colour-encoding graphics, we shall extend this calendar-based arrangement to allow for a broader range of glyphs using linear algebra tools. It has been implemented into the `sugrrants` package using [@r].

This work is motivated by studying hourly foot traffic in Melbourne city. Visualisation provides insights into understanding people's daily schedules or patterns, but it is often a difficult task to visually represent such type of data at the overall level. For example, pedestrian counts in city centre collected at hourly intervals would help with understanding the pulse of city life or improvement of district administration management. However, (1) this kind of data is typically related to multiple seasonal types including time of day, day of week, day of year; (2) owing to higher than daily frequency, the data is usually coupled with long time span; (3) most variations arise from days of week due to normal human activities, and it is of most interest to inspect days as a basic time unit. [@van_wijk_cluster_1999] developed a calendar-based heatmap to visualise (some data), which clearly contrasted weekday versus weekend effects.  Information-dense visual encoding that provides maximal information at the overall level.

# Construction

(NEED A BRIEF INTRO HERE)

## Calendar grids

The algorithm for constructing a calendar plot uses linear algebra, similar to that used in the glyph map displays for spatio-temporal data [@Wickham2012glyph]. To make a year long calendar, requires cells for days, embedded in blocks corresponding to months, organised into a grid layout for a year. Each month can be captured with 35 (5 $\times$ 7) cells, where the top left is Monday of week 1, and the bottom right is Sunday of week 5. These cells provide a micro canvas on which to plot the data. The first day of the month could be any of Monday-Sunday, which is determined by the year of the calendar. Months are of different length days, ranging form 28-31, and each month could extend over six weeks but the convention in these months is to wrap the last few days up to the top row of the block. The notation for creating these cells is as follows: 

* $k = 1, \dots , 7$ is the day of the week that is the first day of the month
* $d = 28, 29, 30$ or $31$ representing the number of days in any month
* $(i, j)$ is the grid position where $1 \le i \le 5$ is week within the month, $1 \le j \le 7$, is day of the week. 
* $g = k, \dots,(k+d)$ indexes the day in the month, inside the 35 possible cells

The grid position for any day in the month is given by

\begin{equation}
  \begin{aligned}
  i &= \lceil (g \mod 35) / 7\rceil, \\
  j &= g \mod 7. (\#eq:grid)
  \end{aligned}
\end{equation}

Figure \@ref(fig:month-diagram) illustrates this $(i,j)$ layout for a month where $k=5$. 

```{r month-diagram, out.width = "360pt", out.height = "250pt", fig.cap = "Illustration of the indexing layout for cells in a month."}
include_graphics("figure/month.pdf")
```

To create the layout for a full year, $(m, n)$ denotes the position of the month arranged in the plot, where $1 \le m \le M$ and $1 \le n \le N$. Between each month requires some small amount of white space, label this $b$. Figure \@ref(fig:year-diagram) illustrates this  layout.

```{r year-diagram, out.width = "360pt", out.height = "250pt", fig.cap = "Illustration of the indexing layout for months of one year."}
include_graphics("figure/year.pdf")
```

Each cell forms a canvas on which to draw the data. Consider the canvas to have limits $[0, 1]$ horizontally and vertically. For the pedestrian sensor data, within each cell hour is plotted horizontally and count is plotted vertically. Each variable is scaled to have values between $[0,1]$, using the minimum and maximum of all the data values to be displayed. Let $h$ be the scaled hour, and $c$ the scaled count. 

Then the final points for making the calendar line plots of the pedestrian sensor data is given by:

\begin{equation}
  \begin{aligned}
  x &= i + (i - 1) \times m + (m - 1) \times b + h, \\
  y &= -j - (j - 1) \times n - (n - 1) \times b + c. (\#eq:final)
  \end{aligned}
\end{equation}

Note that for the vertical direction, the top left is the starting point of the grid, hence the subtractions, and resulting negative values to lay out the cells. Within each cell, the starting position is bottom left. 

## Scales

## Reference lines and labels

The major reference lines are placed on the far left and the bottom for every month panel: for each $m$, the vertical separation is $\min{(x)}$; for each $n$, the horizontal separation is $\min{(y)}$. The month labels located on the top is obtaining $\max{(y)}$ for each $n$. The minor reference lines for every daily grids are placed on the starting positions: for each $i$, the vertical line is $\min{(x)}$; for each $j$, the horizontal line is $\min{(y)}$.

# Extensions

The algorithm can be extended relatively easily to layout multiple years, or to lay out different calendar formats like weeks of a year. A longer term plan is to construct a new facet system for the grammar of graphics, extending the R package `ggplot2`, incorporating this structure, to enable for hierarchical faceting. 

## Interactive graphics

We shall enable interactivity in the calendar-based graphics for time series data. It will allow users to transform different temporal components and switch displays between overlaying and faceting through key strokes or mouse clicks.

# Applications

The calendar-based visualisation provides data plots in the familiar (at least for the Western world) format of an everyday tool. Special events for the region, like Anzac Day in Australia, or Thanksgiving Day in the USA, more easily pop out to the viewer as public holidays, rather than a typical work day. 

This sort of layout may be useful for studying consumer trends, or human behaviour, like the pedestrian patterns. It may not work so well for physical patterns like temperature, which are not typically affected by human activity.
