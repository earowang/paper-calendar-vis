\documentclass[article]{jss}
\usepackage[utf8]{inputenc}

\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

\author{
Earo Wang\\Monash University \And Dianne Cook\\Monash Univeristy \And Rob J Hyndman\\Monash Univeristy
}
\title{Calendar-based graphics for visualising people's daily schedules}

\Plainauthor{Earo Wang, Dianne Cook, Rob J Hyndman}
\Plaintitle{Calendar-based graphics for visualising people's daily schedules}

\Abstract{
It is challenging to visualise people's daily schedules as such data are
often of multiple seasons and of long time span. One example is
Melbourne pedestrian sensor data which are collected at hourly interval
and at a number of locations. Owing to human activities, the data
features multiple temopral scales such as time of day, day of week, day
of year. We develop the \code{frame\_calendar} function that provides a
method for rearranging such kind of data in a calendar-based format and
accomplishing visualisation with the grammar of graphics, and describe
its construction in detail. We provide some examples to demonstrate its
usage by applying to the pedetrian data.
}

\Keywords{calendar-based visualisation, temporal-context data}
\Plainkeywords{calendar-based visualisation, temporal-context data}

%% publication information
%% \Volume{50}
%% \Issue{9}
%% \Month{June}
%% \Year{2012}
%% \Submitdate{}
%% \Acceptdate{2012-06-04}

\Address{
    Earo Wang\\
  Monash University\\
  Department of Econometrics and Business Statistics, Monash University,
  VIC 3800 Australia\\
  E-mail: \email{earo.wang@monash.edu}\\
  
      Dianne Cook\\
  Monash Univeristy\\
  Department of Econometrics and Business Statistics, Monash University,
  VIC 3800 Australia\\
  E-mail: \email{dicook@monash.edu}\\
  
      Rob J Hyndman\\
  Monash Univeristy\\
  Department of Econometrics and Business Statistics, Monash University,
  VIC 3800 Australia\\
  E-mail: \email{rob.hyndman@monash.edu}\\
  
  }

% Pandoc header

\usepackage{amsmath}

\begin{document}

\section{Introduction}\label{introduction}

This work was originally motivated by studying foot traffic in the city
of Melbourne \citep{ped}. There have been 43 installed sensors counting
pedestrians every hour across the downtown area until the end of 2016
(see Figure \ref{fig:ped-map}). The dataset can shed lights into
understanding people's daily schedules, or assisting administration and
business planning. We start off with the conventional time series plot
to take a glimpse at such data. Small multiples, shown as Figure
\ref{fig:time-series-plot}, give an overall picture of foot traffic at a
selection of 7 sensors. Figure \ref{fig:facet-time}, complemented to the
Figure \ref{fig:time-series-plot}, provides another aspect of temporal
patterns in the more detailed level by faceting day of the week. It
lends itself to a number of issues that make exploratory data
visualisation challenging in many temporal-context applications
involving human behaviours:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Variations primarily result from multiple time scales including time
  of day, day of week, and day of year (such as public holiday and
  recurred events).
\item
  Since the data are often collected at daily frequency or a time scale
  more frequent than daily, they typically involve a large number of
  observations spanning over a long time period.
\item
  Measurements of a single type are made at multiple locations at a
  given time point, which creates the need for comparing and contrasting
  between locations.
\end{enumerate}

\begin{CodeChunk}
\begin{figure}

{\centering \includegraphics[width=0.55\linewidth]{figure/ped-map-1} 

}

\caption[Map of the Melbourne city along with purple dots indicating sensor locations]{Map of the Melbourne city along with purple dots indicating sensor locations.}\label{fig:ped-map}
\end{figure}
\end{CodeChunk}

\begin{CodeChunk}
\begin{figure}

{\centering \includegraphics[width=\textwidth]{figure/time-series-plot-1} 

}

\caption[Time series plot about the number of pedestrians over the year of 2016 at a selection of 7 sensors in the city of Melbourne]{Time series plot about the number of pedestrians over the year of 2016 at a selection of 7 sensors in the city of Melbourne. Coloured by the sensors, small multiples of lines show that the foot traffic varies from one sensor to another in terms of both time and number. The traffic, specifically at two train stations (Flagstaff Station and Flinders Street Station), is primarily driven by the commuters, as depicted in the graph.}\label{fig:time-series-plot}
\end{figure}
\end{CodeChunk}

\begin{CodeChunk}
\begin{figure}

{\centering \includegraphics[width=\textwidth]{figure/facet-time-1} 

}

\caption[Hourly pedestrian counts facetted by sensors and days of the week using lines]{Hourly pedestrian counts facetted by sensors and days of the week using lines. It features at least two types of seasons--time of day and day of week--across all the sensors. The temporal patterns are subject to the sensor locations too.}\label{fig:facet-time}
\end{figure}
\end{CodeChunk}

Calendar-based graphics turn out to be a useful tool in unfolding
human-related activities in temporal context (cite). For example,
\citet{VanWijkCluster1999} developed a calendar view of heatmap to
represent the number of employees in the work place over a year, where
colours indicate different clusters derived from the days. It remarkably
contrasts weekdays and weekends, highlights public holiday, and presents
other known seasons like school vacations, all of which have influence
over the turn-outs in the office. The calendar-based heatmap was
implemented in a couple of R packages: \pkg{ggTimeSeries}
\citep{R-ggTimeSeries} and \pkg{ggcal} \citep{R-ggcal}. However, these
techniques are too constrained to colour-encoding graphics and day of
week as the smallest time scale. Time of day, which serves as one of the
most important aspect in explaining variations arising from pedestrian
sensor data, will be neglected through daily aggregation. Additionally
if simply using colours encoded as quantities, it may becomes less
perceivable of the actual variations or behaviours from the viewer's
perspective.

We propose a new algorithm via linear algebra tools to go beyond the
calendar-based heatmap. The approach is developed with these conditions
in mind: (1) to make time of day present in addition to the existing
temporal components such as day of week and day of year, (2) to add line
graphs along with other types of glyphs to the visual toolkit, (3) to
enable an overlaying plot consisting of multiple time series. The
proposed algorithm has been implemented as the \code{frame_calendar}
function in the \pkg{sugrrants} package \citep{R-sugrrants} using
\proglang{R} \citep{R-base}.

The remainder of the paper is organised as follows. Section
\ref{sec:algorithm} describes the \code{frame_calendar} function and its
construction. Section \ref{sec:examples} presents some examples of its
usage. Section \ref{sec:discussion} discusses the advantages and
disadvantages of the method.

\section{Construction}\label{construction}

\label{sec:algorithm}

Figure \ref{fig:flinders-2016} shows the line glyphs organised in the
monthly calendar over the year of 2016. This is achieved by the
\code{frame_calendar} function computing the new coordinates according
to the input data variables; in turn the rearranged data values are
plotted using the \pkg{ggplot2} package \citep{R-ggplot2}, which is the
implementation of the grammar of graphics (\citet{wilkinson2006grammar}
and \citet{wickham2010layered}). The \code{frame_calendar} function
assumes that the underlying data structure is tidy data
\citep{wickham2014tidy}.

\begin{CodeChunk}
\begin{figure}

{\centering \includegraphics[width=\textwidth]{figure/flinders-2016-1} 

}

\caption[The calendar-based display of hourly foot traffic at Flinders Street Station using line glyphs]{The calendar-based display of hourly foot traffic at Flinders Street Station using line glyphs. The arrangement of 3 by 4 on the monthly calendar format presents all the traffic in 2016. The disparities between weekday and weekend along with public holiday pop out to viewers in the clearer manner.}\label{fig:flinders-2016}
\end{figure}
\end{CodeChunk}

The algorithms to construct calendar grids, several scales, as well as
reference lines and labels are described in the section.

\subsection{Grid construction}\label{grid-construction}

\label{sec:grid}

The algorithm for constructing a calendar plot uses linear algebra,
similar to that used in the glyph map displays for spatio-temporal data
\citep{Wickham2012glyph}. To make a year long calendar, requires cells
for days, embedded in blocks corresponding to months, organised into a
grid layout for a year. Each month can be captured with 35 (5 \(\times\)
7) cells, where the top left is Monday of week 1, and the bottom right
is Sunday of week 5. These cells provide a micro canvas on which to plot
the data. The first day of the month could be any of Monday-Sunday,
which is determined by the year of the calendar. Months are of different
length days, ranging form 28-31, and each month could extend over six
weeks but the convention in these months is to wrap the last few days up
to the top row of the block. The notation for creating these cells is as
follows:

\begin{itemize}
\tightlist
\item
  \(k = 1, \dots , 7\) is the day of the week that is the first day of
  the month.
\item
  \(d = 28, 29, 30\) or \(31\) representing the number of days in any
  month.
\item
  \((i, j)\) is the grid position where \(1 \le i \le 5\) is week within
  the month, \(1 \le j \le 7\), is day of the week.
\item
  \(g = k, \dots,(k+d)\) indexes the day in the month, inside the 35
  possible cells.
\end{itemize}

The grid position for any day in the month is given by

\begin{equation}
  \begin{aligned}
  i &= \lceil (g \mod 35) / 7\rceil, \\
  j &= g \mod 7. \label{eq:grid}
  \end{aligned}
\end{equation}

Figure \ref{fig:month-diagram} illustrates this \((i,j)\) layout for a
month where \(k=5\).

\begin{CodeChunk}
\begin{figure}

{\centering \includegraphics[width=360pt,height=250pt]{figure/month} 

}

\caption[Illustration of the indexing layout for cells in a month]{Illustration of the indexing layout for cells in a month.}\label{fig:month-diagram}
\end{figure}
\end{CodeChunk}

To create the layout for a full year, \((m, n)\) denotes the position of
the month arranged in the plot, where \(1 \le m \le M\) and
\(1 \le n \le N\). Between each month requires some small amount of
white space, label this \(b\). Figure \ref{fig:year-diagram} illustrates
this layout.

\begin{CodeChunk}
\begin{figure}

{\centering \includegraphics[width=360pt,height=250pt]{figure/year} 

}

\caption[Illustration of the indexing layout for months of one year]{Illustration of the indexing layout for months of one year.}\label{fig:year-diagram}
\end{figure}
\end{CodeChunk}

Each cell forms a canvas on which to draw the data. Consider the canvas
to have limits \([0, 1]\) horizontally and vertically. For the
pedestrian sensor data, within each cell hour is plotted horizontally
and count is plotted vertically. Each variable is scaled to have values
between \([0,1]\), using the minimum and maximum of all the data values
to be displayed assuming of fixed scales. Let \(h\) be the scaled hour,
and \(c\) the scaled count.

Then the final points for making the calendar line plots of the
pedestrian sensor data is given by:

\begin{equation}
  \begin{aligned}
  x &= i + (i - 1) \times m + (m - 1) \times b + h, \\
  y &= -j - (j - 1) \times n - (n - 1) \times b + c. \label{eq:final}
  \end{aligned}
\end{equation}

Note that for the vertical direction, the top left is the starting point
of the grid, hence the subtractions, and resulting negative values to
lay out the cells. Within each cell, the starting position is bottom
left.

The algorithm can be relatively easily extended to layout from a single
month to a few years, based on the period of time to be visualised.
\((M, N)\) can be determined by the user using the arguments of
\code{nrow} and \code{ncol}. If the one would like to visualise data
spanning over three years, for example, \(M = 12\) and \(N = 3\) seem to
be an appropriate choice when assessing the differences of a given month
across the years.

The algorithm can be simplified to accommodate the other two types of
calendar formats. One is comprised of days of a week in columns and
weeks of a year in rows, and the other is days of a month in columns and
months of a year in rows, which we refer to as ``weekly'' and ``daily''
calendar respectively. Due to the way of the arrangement, the weekly
calendar puts more emphases on days of a week over days of a year,
whereas the daily one serves as the opposite. The monthly format can be
considered as the advanced twist of both weekly and daily. Temporal
patterns lead to which format to be employed. The weekly calendar can be
a nice attempt if the most variations can be characterised by days of a
week. On the other hand, the absence of weekly effect but the presence
of yearly effect can direct to the daily calendar. When both are
present, the monthly calendar appears to be a better choice.

We only illustrate that grids are laid out over the horizontal direction
in the paper. The vertical direction can be enabled by swapping \(i\)
and \(j\) in the algorithm stated above. It particularly benefits those
users who get accustomed to calendars of vertical organisation in some
countries.

\subsection{Scales}\label{scales}

Section \ref{sec:grid} discusses the implementation applied to the fixed
scale which is using the whole range of all the data values. The
\code{scale} argument controls the scaling of the display. In addition
to the fixed scale (\code{fixed}), the remaining options include free
scale on all the days (\code{free}), day of the week only
(\code{free_wday}), and day of the month only (\code{free_mday}) for
different comparisons.

Grouping the cells according to the common period give rise to these
scales. The minimums and maximums obtained for every \((i, j)\) and
\((m, n)\) allow for individual scale over all the single days.
Similarly, \(j\) indexing day of the week is grouped to determine the
scales on days of a week, and \(g\) representing the day in the month is
for the scales on days of a month.

Figure \ref{fig:flinders-2016} is drawn on the fixed scale so that it
makes the magnitudes comparable over the whole period of time. On the
other hand, some sub-series of small magnitudes yet worth-noting
behaviours may become invisible whilst embedded in the overall picture.
These sorts of scales, as a result, complements the calendar-based
visualisation in general. Figure \ref{fig:flinders-free} provides an
example of the free scale on all the days.

\begin{CodeChunk}
\begin{figure}

{\centering \includegraphics[width=\textwidth]{figure/flinders-free-1} 

}

\caption[Line glyphs on the calendar format showing hourly foot traffic at Flinders Street Station, scaled over all the days]{Line glyphs on the calendar format showing hourly foot traffic at Flinders Street Station, scaled over all the days. The individual shape on a single day becomes more distinctive at the expense of the magnitude comparison loss.}\label{fig:flinders-free}
\end{figure}
\end{CodeChunk}

\subsection{Reference lines and
labels}\label{reference-lines-and-labels}

Reference lines dividing each cell and block as well as labels
indicating weekday and month are also provided in order to make
calendar-based graphics more accessible and informative.

Regarding the monthly calendar, the major reference lines separate every
month panel and the minor ones separate every cell, represented by the
think and thin lines respectively. The major reference lines are placed
surrounding every month block: for each \(m\), the vertical lines are
determined by \(\min{(x)}\) and \(\max{(x)}\); for each \(n\), the
horizontal lines are given by \(\min{(y)}\) and \(\max{(y)}\). The minor
reference lines are placed on the left side of every cell: for each
\(i\), the vertical division is \(\min{(x)}\); for each \(j\), the
horizontal is \(\min{(y)}\).

The abbreviated month labels located on the top left are obtained
through \((\min{(x)}, \max{(y)})\) for every \(m\) and \(n\). The
weekday texts with a single letter are uniformly placed on the bottom of
the whole canvas, that is \(\min{(y)}\), with the central position of a
cell \(x / 2\) for each \(j\).

\section{Examples}\label{examples}

\label{sec:examples}

\subsection{Lag scatterplot}\label{lag-scatterplot}

\begin{CodeChunk}
\begin{figure}

{\centering \includegraphics[width=\textwidth]{figure/scatterplot-1} 

}

\caption[Lag scatterplot on the daily calendar]{Lag scatterplot on the daily calendar. Lagged hourly counts are plotted against current ones to demonstrate the autocorrelation at the order of 1. The positive association between the one-hour-ahead count and the present regardless of the data values takes place on non-working days.}\label{fig:scatterplot}
\end{figure}
\end{CodeChunk}

\subsection{Overlaying graph}\label{overlaying-graph}

The comparison of one sensor to the other adds additional insights to
the dataset, which is commonly done with an overlaying plot such as
Figure \ref{fig:overlay}. For instance, the dominant patterns occurred
to both train stations--Flinders Street Station and Flagstaff
station--are together driven by the commuters on the work days; however,
the former is overwhelmed by the number of pedestrians during the
weekends and public holidays, compared to the latter. It suggests that
Flagstaff station limits its functionality as simply the public
transport hub for day-to-day commuters, but various activities take
place around the Flinders Street Station other than commuting. Because
Flinders Street Station closely lies to South Bank and other places of
attractions where the locals go for leisure and the tourists for
travelling.

\begin{CodeChunk}
\begin{figure}

{\centering \includegraphics[width=\textwidth]{figure/overlay-1} 

}

\caption[Superimposing line graphs of two sensors on the monthly calendar]{Superimposing line graphs of two sensors on the monthly calendar. The orange line, represented by the number of pedestrians at Flinders Street Station, is on top of the green one indicating Flagstaff Station. Flinders Street Station attracts more pedestrians during the afternoon time and non-working days.}\label{fig:overlay}
\end{figure}
\end{CodeChunk}

The nighttime events, such as White Night and New Year Evening Firework,
has barely affected the operation of Flagstaff Station but heavily
affected the incoming traffic to Flinders Street Station on these days.

\subsection{Boxplot}\label{boxplot}

\begin{CodeChunk}
\begin{figure}

{\centering \includegraphics[width=\textwidth]{figure/boxplot-1} 

}

\caption[Boxplot of hourly counts across all the 43 sensors in December of 2016, with the superimposing hourly averages]{Boxplot of hourly counts across all the 43 sensors in December of 2016, with the superimposing hourly averages. It shows the hourly distribution in the city as a whole. Christmas stands out as the quietest day in December.}\label{fig:boxplot}
\end{figure}
\end{CodeChunk}

\section{Discussion}\label{discussion}

\label{sec:discussion}

The calendar-based visualisation provides data plots in the familiar (at
least for the Western world) format of an everyday tool. Special events
for the region, like Anzac Day in Australia, or Thanksgiving Day in the
USA, more easily pop out to the viewer as public holidays, rather than a
typical work day.

This sort of layout may be useful for studying consumer trends, or human
behaviour, like the pedestrian patterns. It may not work so well for
physical patterns like temperature, which are not typically affected by
human activity.

\bibliography{packages.bib,references.bib}


\end{document}

